(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-index-index"],{"03bb":function(t,e,a){"use strict";a("a15b"),a("fb6a"),a("4e82"),a("ac1f"),a("1276"),Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i={data:function(){return{modalName:null,listTouchStart:0,listTouchDirection:null,chatData:{},newMessage:{},messageList:[],id_to_name:{},id_to_avatar:{}}},onLoad:function(){var t=this;this.goToChat=getApp().globalData.goToChat,this.getChatData(),this.getNewMessage(),this.setMessageList(),this.messagetimer=window.setInterval((function(){setTimeout((function(){t.getChatData(),t.getNewMessage(),t.setMessageList()}),0)}),1e3)},mounted:function(){},methods:{getChatData:function(){this.chatData=getApp().globalData.chatData},getNewMessage:function(){this.newMessage=getApp().globalData.newMessage},messageDisplay:function(t,e){for(var a="",i=0;i<t.message.length;i++)a+=t.message[i].display;return"friend"==e?a:t.sender+": "+a},timeTransform:function(t){var e=["日","一","二","三","四","五","六"],a=new Date,i=Date.parse(t),s=a.getDay();0==s&&(s=7);var n="-",o=a.getFullYear(),c=a.getMonth()+1,r=a.getDate(),l=t.split(" ")[0],u=l.split("-")[0],d=l.split("-")[1],f=l.split("-")[2];c>=1&&c<=9&&(c="0"+c),r>=0&&r<=9&&(r="0"+r);var g=o+n+c+n+r;if(l==g)return t.split(" ")[1].split(":").slice(0,2).join(":");if(u<o)return u.slice(2)+"/"+d+"/"+f;var v=Math.floor(Math.abs(a-i)/864e5)+1;return 1==v?"昨天":2==v?"前天":v<7?"星期"+e[(s+7-v)%7]:t.split(" ")[0]},setMessageList:function(){for(var t in this.messageList=[],this.chatData)if(this.chatData[t].data.length>0){var e=this.chatData[t].data.slice(-1)[0];this.getInfoFromId(t,this.chatData[t].type),this.messageList.push({target:t,time:e.time,timeStr:this.timeTransform(e.time),sender:e.sender,displayName:this.id_to_name[t],display:this.messageDisplay(e,this.chatData[t].type),newMessages:t in this.newMessage?this.newMessage[t]:0})}this.messageList.sort((function(t,e){return e.time<t.time?-1:1}))},getInfoFromId:function(t,e){var a=getApp().globalData.apiUrl+"/info/"+("friend"==e?"user":"group")+"/",i="Null",s=this;return uni.request({url:a,method:"GET",data:{account:getApp().globalData.accountInfo.account,cookie:getApp().globalData.accountInfo.cookie,target:t},dataType:"json",success:function(a){var i=a.data;if(200==i.code)return s.id_to_name[t]="friend"==e?void 0!=i.data.nickname?i.data.nickname:i.data.username:void 0!=i.data.name?i.data.name:i.data.group_id,void(s.id_to_avatar[t]=null!=i.data.avatar?i.data.avatar:getApp().globalData.defaultAvatar);401==i.code||(403==i.code?(s.id_to_name[t]="idNotFoundError",s.id_to_avatar[t]=getApp().globalData.defaultAvatar):(s.id_to_name[t]="displayNameError",s.id_to_avatar[t]=getApp().globalData.defaultAvatar))}}),i},ListTouchStart:function(t){this.listTouchStart=t.touches[0].pageX},ListTouchMove:function(t){this.listTouchDirection=t.touches[0].pageX-this.listTouchStart>0?"right":"left"},ListTouchEnd:function(t){"left"==this.listTouchDirection?this.modalName=t.currentTarget.dataset.target:this.modalName=null,this.listTouchDirection=null}},destroyed:function(){window.clearInterval(this.messagetimer),window.clearInterval(this.infotimer)}};e.default=i},"0928":function(t,e,a){"use strict";var i=a("1f57"),s=a.n(i);s.a},"1f57":function(t,e,a){var i=a("d5cb");"string"===typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);var s=a("4f06").default;s("cfabb9b2",i,!0,{sourceMap:!1,shadowMode:!1})},"25ad":function(t,e,a){"use strict";var i;a.d(e,"b",(function(){return s})),a.d(e,"c",(function(){return n})),a.d(e,"a",(function(){return i}));var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-uni-view",[a("v-uni-view",{staticClass:"cu-list menu-avatar"},t._l(t.messageList,(function(e,i){return a("v-uni-view",{key:i,staticClass:"cu-item",on:{click:function(a){arguments[0]=a=t.$handleEvent(a),t.goToChat(e.target)}}},[a("v-uni-view",{staticClass:"cu-avatar round lg",style:{backgroundImage:"url("+t.id_to_avatar[e.target]+")"}}),a("v-uni-view",{staticClass:"chat-content"},[a("v-uni-view",{staticClass:"text-grey"},[t._v(t._s(e.displayName))]),a("v-uni-view",{staticClass:"text-gray text-sm flex"},[a("v-uni-text",{staticClass:"uni-lastmsg"},[t._v(t._s(e.display.replace(/\n/g,"")))])],1)],1),a("v-uni-view",{staticClass:"action"},[a("v-uni-view",{staticClass:"text-grey text-xs"},[t._v(t._s(e.timeStr))]),a("v-uni-view",{directives:[{name:"show",rawName:"v-show",value:!!e.newMessages,expression:"item.newMessages?true:false"}],staticClass:"cu-tag round bg-grey sm"},[t._v(t._s(e.newMessages))])],1),a("v-uni-view",{staticClass:"move"},[a("v-uni-view",{staticClass:"bg-red"},[t._v("删除")])],1)],1)})),1)],1)},n=[]},c5e7:function(t,e,a){"use strict";a.r(e);var i=a("03bb"),s=a.n(i);for(var n in i)"default"!==n&&function(t){a.d(e,t,(function(){return i[t]}))}(n);e["default"]=s.a},d5cb:function(t,e,a){var i=a("24fb");e=i(!1),e.push([t.i,'.content[data-v-4c41f67c]{display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;flex-direction:column;-webkit-box-align:center;-webkit-align-items:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;justify-content:center}.logo[data-v-4c41f67c]{height:%?200?%;width:%?200?%;margin-top:%?200?%;margin-left:auto;margin-right:auto;margin-bottom:%?50?%}.text-area[data-v-4c41f67c]{display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-pack:center;-webkit-justify-content:center;justify-content:center}.title[data-v-4c41f67c]{font-size:%?36?%;color:#8f8f94}.page[data-v-4c41f67c]{height:100Vh;width:100vw}.page.show[data-v-4c41f67c]{overflow:hidden}.switch-sex[data-v-4c41f67c]::after{content:"\\e716"}.switch-sex[data-v-4c41f67c]::before{content:"\\e7a9"}.switch-music[data-v-4c41f67c]::after{content:"\\e66a"}.switch-music[data-v-4c41f67c]::before{content:"\\e6db"}.chat-content[data-v-4c41f67c]{position:absolute;left:%?146?%;width:calc(100% - %?96?% - %?60?% - %?120?% - %?20?%);line-height:1.6em}.uni-lastmsg[data-v-4c41f67c]{text-overflow:ellipsis;overflow:hidden;white-space:nowrap}',""]),t.exports=e},ff12:function(t,e,a){"use strict";a.r(e);var i=a("25ad"),s=a("c5e7");for(var n in s)"default"!==n&&function(t){a.d(e,t,(function(){return s[t]}))}(n);a("0928");var o,c=a("f0c5"),r=Object(c["a"])(s["default"],i["b"],i["c"],!1,null,"4c41f67c",null,!1,i["a"],o);e["default"]=r.exports}}]);