(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-chat"],{"06c5":function(t,e,a){"use strict";a("a630"),a("fb6a"),a("d3b7"),a("25f0"),a("3ca3"),Object.defineProperty(e,"__esModule",{value:!0}),e.default=i;var n=s(a("6b75"));function s(t){return t&&t.__esModule?t:{default:t}}function i(t,e){if(t){if("string"===typeof t)return(0,n.default)(t,e);var a=Object.prototype.toString.call(t).slice(8,-1);return"Object"===a&&t.constructor&&(a=t.constructor.name),"Map"===a||"Set"===a?Array.from(t):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?(0,n.default)(t,e):void 0}}},"09f0":function(t,e,a){"use strict";function n(t,e){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(t)){var a=[],n=!0,s=!1,i=void 0;try{for(var o,r=t[Symbol.iterator]();!(n=(o=r.next()).done);n=!0)if(a.push(o.value),e&&a.length===e)break}catch(u){s=!0,i=u}finally{try{n||null==r["return"]||r["return"]()}finally{if(s)throw i}}return a}}a("a4d3"),a("e01a"),a("d28b"),a("d3b7"),a("3ca3"),a("ddb0"),Object.defineProperty(e,"__esModule",{value:!0}),e.default=n},"0d21":function(t,e,a){"use strict";function n(t){if(Array.isArray(t))return t}Object.defineProperty(e,"__esModule",{value:!0}),e.default=n},"1ed2":function(t,e,a){var n=a("24fb");e=n(!1),e.push([t.i,"uni-page-body[data-v-bbdbd87a]{padding-bottom:%?100?%}",""]),t.exports=e},3835:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=u;var n=r(a("0d21")),s=r(a("09f0")),i=r(a("06c5")),o=r(a("3d8c"));function r(t){return t&&t.__esModule?t:{default:t}}function u(t,e){return(0,n.default)(t)||(0,s.default)(t,e)||(0,i.default)(t,e)||(0,o.default)()}},"3d8c":function(t,e,a){"use strict";function n(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}Object.defineProperty(e,"__esModule",{value:!0}),e.default=n},"433c":function(t,e,a){var n=a("1ed2");"string"===typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);var s=a("4f06").default;s("54d139e2",n,!0,{sourceMap:!1,shadowMode:!1})},"6b75":function(t,e,a){"use strict";function n(t,e){(null==e||e>t.length)&&(e=t.length);for(var a=0,n=new Array(e);a<e;a++)n[a]=t[a];return n}Object.defineProperty(e,"__esModule",{value:!0}),e.default=n},"7f96":function(t,e,a){"use strict";(function(t){var n=a("4ea4");a("ac1f"),a("5319"),Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var s=n(a("3835")),i={data:function(){return{InputBottom:0,isFriend:!0,messageList:[],selfAccount:0,id_to_avatar:{},id:0,type:"None",messageToSend:[],messageText:"",wh:0}},onLoad:function(e){this.id=e.id,this.getType(e.id),this.getMessages(e.id),this.selfAccount=getApp().globalData.accountInfo.account,this.$nextTick((function(){setTimeout((function(){uni.createSelectorQuery().select(".cu-chat").boundingClientRect((function(e){t("log","标签获取====>",e," at pages/chat.vue:63"),uni.pageScrollTo({scrollTop:e.height,duration:0})})).exec()}),50)}))},onShow:function(){this.getMessages(this.id)},onHide:function(){},updated:function(){uni.pageScrollTo({scrollTop:99999,duration:300})},methods:{handleScroll:function(t){var e=t.target.scrollTop;this.gotop=e>30},goBottom:function(){uni.pageScrollTo({scrollTop:99999,duration:300})},InputFocus:function(t){this.InputBottom=t.detail.height},InputBlur:function(t){this.InputBottom=0},getMessages:function(t){t in getApp().globalData.chatData&&(this.messageList=getApp().globalData.chatData[t].data),this.goBottom()},messageDisplay:function(t){for(var e="",a=0;a<t.message.length;a++)e+=t.message[a].display;return e},messageElementToHtml:function(t){for(var e="",a=0;a<t.length;a++)null!=t[a]&&("Plain"==t[a].type?e+="<text>"+t[a].content.replace(/\n/g,"<br/>")+"</text>":"Image"==t[a].type&&(e+="<image src='"+t[a].content+"' class='radius' style='display: inline-block; width: 100%; max-width: 100%; height: auto;'></image>"));return e},getType:function(t){var e=getApp().globalData.apiUrl+"/info/idType/",a=this;uni.request({url:e,method:"GET",data:{id:t},dataType:"json",success:function(t){var e=t.data;200==e.code?a.type=e.data:a.type=null}})},getCurrentTime:function(){var t=new Date,e=t.getFullYear(),a=t.getMonth()+1,n=t.getDate(),s=t.getHours(),i=t.getMinutes()<10?"0"+t.getMinutes():t.getMinutes(),o=t.getSeconds()<10?"0"+t.getSeconds():t.getSeconds();return e+"/"+a+"/"+n+" "+s+":"+i+":"+o},sendMessage:function(){this.messageToSend!=[]&&""!=this.messageText&&(getApp().globalData.websocketsend(JSON.stringify({type:"Send"+this.type+"Message",account:getApp().globalData.accountInfo.account,cookie:getApp().globalData.accountInfo.cookie,target:this.id,messageChain:[{type:"Plain",content:this.messageText,display:this.messageText}]})),this.id in getApp().globalData.chatData||(getApp().globalData.chatData[this.id]={type:this.type,data:[]}),getApp().globalData.chatData[this.id].data.push({sender:getApp().globalData.accountInfo.account,time:this.getCurrentTime(),message:[{type:"Plain",content:this.messageText,display:this.messageText}]}),this.messageToSend=[],this.messageText="")},refreshAvatars:function(){for(var t=0;t<this.messageList.length;t++)this.getAvatar(this.messageList[t].sender+"")},getAvatar:function(t){if(t in this.id_to_avatar&&void 0!=this.id_to_avatar[t])return this.id_to_avatar[t];if(t in getApp().globalData.groupData)return this.id_to_avatar[t]=getApp().globalData.groupData[t].avatar,this.id_to_avatar[t];if(t in getApp().globalData.userData)return this.id_to_avatar[t]=getApp().globalData.userData[t].avatar,this.id_to_avatar[t];this.id_to_avatar[t]=null;var e=getApp().globalData.apiUrl+"/info/user/",a=this;uni.request({url:e,method:"GET",data:{account:getApp().globalData.accountInfo.account,cookie:getApp().globalData.accountInfo.cookie,target:t},dataType:"json"}).then((function(e){var n=(0,s.default)(e,2),i=(n[0],n[1]),o=i.data.data;return a.id_to_avatar[t]=o.avatar,o.avatar}))},selfAvatar:function(){return getApp().globalData.accountInfo.avatar}}};e.default=i}).call(this,a("0de9")["log"])},"8b52":function(t,e,a){"use strict";a.r(e);var n=a("7f96"),s=a.n(n);for(var i in n)"default"!==i&&function(t){a.d(e,t,(function(){return n[t]}))}(i);e["default"]=s.a},"9bce":function(t,e,a){"use strict";a.r(e);var n=a("ffd8"),s=a("8b52");for(var i in s)"default"!==i&&function(t){a.d(e,t,(function(){return s[t]}))}(i);a("be6a");var o,r=a("f0c5"),u=Object(r["a"])(s["default"],n["b"],n["c"],!1,null,"bbdbd87a",null,!1,n["a"],o);e["default"]=u.exports},be6a:function(t,e,a){"use strict";var n=a("433c"),s=a.n(n);s.a},ffd8:function(t,e,a){"use strict";var n;a.d(e,"b",(function(){return s})),a.d(e,"c",(function(){return i})),a.d(e,"a",(function(){return n}));var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-uni-view",[a("v-uni-view",{staticClass:"cu-chat",attrs:{id:"chat-box"}},t._l(t.messageList,(function(e,n){return a("v-uni-view",{key:n,staticClass:"cu-item",class:e.sender==t.selfAccount?"self":""},[a("v-uni-view",{directives:[{name:"show",rawName:"v-show",value:e.sender!=t.selfAccount,expression:"item.sender != selfAccount"}],staticClass:"cu-avatar radius",style:{backgroundImage:"url("+t.getAvatar(e.sender)+")"}}),a("v-uni-view",{staticClass:"main"},[a("v-uni-view",{staticClass:"content shadow flex-wrap justify-start"},[a("v-uni-view",{domProps:{innerHTML:t._s(t.messageElementToHtml(e.message))}})],1)],1),a("v-uni-view",{directives:[{name:"show",rawName:"v-show",value:e.sender==t.selfAccount,expression:"item.sender == selfAccount"}],staticClass:"cu-avatar radius",style:{backgroundImage:"url("+t.selfAvatar()+")"}}),a("v-uni-view",{staticClass:"date"},[t._v(t._s(e.time))])],1)})),1),a("v-uni-view",{staticClass:"cu-bar foot input",style:[{bottom:t.InputBottom+"px"}]},[a("v-uni-view",{staticClass:"action"},[a("v-uni-text",{staticClass:"cuIcon-roundadd text-grey"})],1),a("v-uni-input",{staticClass:"solid-bottom",attrs:{"adjust-position":!1,focus:!1,maxlength:"300","cursor-spacing":"10"},on:{focus:function(e){arguments[0]=e=t.$handleEvent(e),t.InputFocus.apply(void 0,arguments)},blur:function(e){arguments[0]=e=t.$handleEvent(e),t.InputBlur.apply(void 0,arguments)}},model:{value:t.messageText,callback:function(e){t.messageText=e},expression:"messageText"}}),a("v-uni-button",{staticClass:"cu-btn bg-green shadow",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.sendMessage.apply(void 0,arguments)}}},[t._v("发送")])],1)],1)},i=[]}}]);